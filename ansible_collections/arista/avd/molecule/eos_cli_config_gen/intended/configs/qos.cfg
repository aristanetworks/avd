!RANCID-CONTENT-TYPE: arista
!
transceiver qsfp default-mode 4x10G
!
hostname qos
!
qos profile experiment
   qos trust cos
   qos cos 2
   service-policy type qos input test_qos_policy_v1
   !
   tx-queue 3
      bandwidth percent 30
      no priority
   !
   tx-queue 4
      bandwidth guaranteed percent 10
   !
   tx-queue 5
      bandwidth percent 40
   !
   tx-queue 7
      bandwidth percent 30
      shape rate 40 percent
!
qos profile no_qos_trust
   no qos trust
   qos cos 3
   qos dscp 4
!
qos profile qprof_testwithpolicy
   service-policy type qos input pmap_test1
   !
   tx-queue 0
      bandwidth percent 1
   !
   tx-queue 1
      bandwidth percent 80
   !
   tx-queue 5
      !! Multi-line comment
      !! here.
      bandwidth percent 19
      no priority
!
qos profile test
   qos trust dscp
   qos dscp 46
   shape rate 80 percent
   !
   tx-queue 1
      bandwidth percent 50
      no priority
   !
   tx-queue 2
      bandwidth percent 10
      priority strict
      random-detect ecn minimum-threshold 320 kbytes maximum-threshold 320 kbytes max-mark-probability 90
   !
   tx-queue 4
      bandwidth guaranteed percent 10
      random-detect ecn minimum-threshold 320 segments maximum-threshold 320 segments weight 10
!
qos profile test_with_pfc
   service-policy type qos input pmap_test1
   !
   tx-queue 0
      bandwidth percent 1
   !
   tx-queue 1
      bandwidth percent 80
   !
   tx-queue 5
      bandwidth percent 19
      no priority
   !
   priority-flow-control on
   priority-flow-control priority 0 no-drop
   priority-flow-control priority 1 drop
   priority-flow-control pause watchdog
   priority-flow-control pause watchdog port action drop
   priority-flow-control pause watchdog port timer timeout 0.05 polling-interval auto recovery-time 1.11 forced
!
qos profile uc_mc_queues_test
   !
   uc-tx-queue 1
      !! Test no priority
      bandwidth percent 50
      no priority
      random-detect ecn minimum-threshold 3 milliseconds maximum-threshold 9 milliseconds max-mark-probability 90
   !
   uc-tx-queue 2
      bandwidth percent 10
      priority strict
      random-detect ecn minimum-threshold 320 kbytes maximum-threshold 320 kbytes max-mark-probability 90
   !
   uc-tx-queue 4
      !! Test guaranteed percent
      bandwidth guaranteed percent 10
      random-detect ecn minimum-threshold 320 segments maximum-threshold 320 segments weight 10
   !
   mc-tx-queue 1
      bandwidth percent 50
      no priority
   !
   mc-tx-queue 2
      !! Test strict priority
      bandwidth percent 10
      priority strict
   !
   mc-tx-queue 4
      !! Test guaranteed percent
      bandwidth guaranteed percent 10
!
qos profile wred_queues_test
   !
   tx-queue 1
      !! Test no priority
      bandwidth percent 50
      no priority
      random-detect drop minimum-threshold 1 kbytes maximum-threshold 10 kbytes drop-probability 100
   !
   tx-queue 2
      bandwidth percent 10
      priority strict
      random-detect drop drop-precedence 2 minimum-threshold 2 kbytes maximum-threshold 200 kbytes drop-probability 50 weight 10
   !
   tx-queue 3
      bandwidth percent 10
      priority strict
      random-detect ecn minimum-threshold 320 kbytes maximum-threshold 320 kbytes weight 10
   !
   tx-queue 4
      !! Test guaranteed percent
      bandwidth guaranteed percent 10
      random-detect drop minimum-threshold 1 kbytes maximum-threshold 10 kbytes drop-probability 90
   !
   mc-tx-queue 1
      bandwidth percent 50
      no priority
   !
   mc-tx-queue 2
      !! Test strict priority
      bandwidth percent 10
      priority strict
   !
   mc-tx-queue 4
      !! Test guaranteed percent
      bandwidth guaranteed percent 10
!
qos profile wred_uc_queues_test
   !
   uc-tx-queue 1
      !! Test no priority
      bandwidth percent 50
      no priority
      random-detect drop minimum-threshold 1 microseconds maximum-threshold 10 microseconds drop-probability 90 weight 15
   !
   uc-tx-queue 2
      bandwidth percent 10
      priority strict
      random-detect drop drop-precedence 1 minimum-threshold 2 milliseconds maximum-threshold 20 milliseconds drop-probability 80
   !
   uc-tx-queue 4
      !! Test guaranteed percent
      bandwidth guaranteed percent 10
      random-detect drop minimum-threshold 1 microseconds maximum-threshold 10 microseconds drop-probability 90
!
no enable password
no aaa root
!
interface Port-Channel3
   description MLAG_PEER_DC1-LEAF1B_Po3
   switchport
   switchport trunk allowed vlan 2-4094
   switchport mode trunk
   switchport trunk group LEAF_PEER_L3
   switchport trunk group MLAG
   qos trust cos
   qos cos 2
   service-profile experiment
   service-policy type qos input pmap_test1
!
interface Ethernet1
   description P2P_LINK_TO_DC1-SPINE1_Ethernet1
   mtu 1500
   no switchport
   ip address 172.31.255.1/31
   qos trust dscp
   qos dscp 48
   service-policy type qos input pmap_test1
   service-profile test
!
interface Ethernet3
   description MLAG_PEER_DC1-LEAF1B_Ethernet3
   channel-group 3 mode active
!
interface Ethernet4
   description MLAG_PEER_DC1-LEAF1B_Ethernet4
   channel-group 3 mode active
!
interface Ethernet6
   description SRV-POD02_Eth1
   switchport trunk allowed vlan 110-111,210-211
   switchport mode trunk
   switchport
   qos trust cos
   qos cos 2
   service-profile experiment
   !
   tx-queue 2
      random-detect ecn count
!
interface Ethernet7
   description Test-with-policymap
   switchport trunk allowed vlan 110-111,210-211
   switchport mode trunk
   switchport
   service-profile qprof_testwithpolicy
   !
   uc-tx-queue 4
      random-detect ecn count
!
interface Management1
   description oob_management
   vrf MGMT
   ip address 10.73.255.122/24
!
ipv6 access-list acl_qos_tc0_v6
   10 permit ipv6 any any dscp cs1
!
ipv6 access-list acl_qos_tc5_v6
   10 permit ipv6 any 2001:db8::/48
!
ip access-list acl_qos_tc0_v4
   10 permit ip any 192.0.2.0/29
!
ip access-list acl_qos_tc5_v4
   10 permit ip any any dscp ef
!
qos rewrite dscp
qos map cos 1 2 3 4 to traffic-class 2
qos map cos 3 to traffic-class 3
qos map dscp 8 9 10 11 12 13 14 15 16 17 19 21 23 24 25 27 29 31 32 33 35 37 39 40 41 42 43 44 45 47 49 50 51 52 53 54 55 57 58 59 60 61 62 63 to traffic-class 1
qos map dscp 18 20 22 26 28 30 34 36 38 to traffic-class 4 drop-precedence 2
qos map dscp 46 to traffic-class 5
qos map traffic-class 1 to dscp 56
qos map traffic-class 2 4 5 to cos 7
qos map traffic-class 6 to tx-queue 2
qos map exp 0 to traffic-class 0
!
qos random-detect ecn allow non-ect chip-based
!
priority-flow-control all off
priority-flow-control pause watchdog action no-drop
priority-flow-control pause watchdog default timeout 0.05
priority-flow-control pause watchdog default polling-interval 10.001
priority-flow-control pause watchdog default recovery-time 1.22
!
class-map type qos match-any cmap_tc0_v4
   match ip access-group acl_qos_tc0_v4
!
class-map type qos match-any cmap_tc0_v6
   match ipv6 access-group acl_qos_tc0_v6
!
class-map type qos match-any cmap_tc5_v4
   match ip access-group acl_qos_tc5_v4
!
class-map type qos match-any cmap_tc5_v6
   match ipv6 access-group acl_qos_tc5_v6
!
policy-map type quality-of-service pmap_test1
   class cmap_tc0_v4
      set traffic-class 0
   !
   class cmap_tc5_v4
      set traffic-class 5
   !
   class cmap_tc5_v6
      set traffic-class 5
   !
   class cmap_tc0_v6
      set traffic-class 0
   !
   class class-default
      set traffic-class 1
!
end
