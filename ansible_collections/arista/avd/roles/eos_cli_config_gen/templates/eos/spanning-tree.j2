{# spanning-tree #}
{% if spanning_tree is arista.avd.defined %}
!
{%     if spanning_tree.root_super is arista.avd.defined(true) %}
spanning-tree root super
{%     endif %}
{%     if spanning_tree.mode is arista.avd.defined() %}
spanning-tree mode {{ spanning_tree.mode }}
{%     endif %}
{%     if spanning_tree.no_spanning_tree_vlan is arista.avd.defined %}
no spanning-tree vlan-id {{ spanning_tree.no_spanning_tree_vlan }}
{%     endif %}
{%     if spanning_tree.mst.pvst_border is arista.avd.defined(true) %}
spanning-tree mst pvst border
{%     endif %}
{%     if spanning_tree.edge_port.bpduguard_default is arista.avd.defined(true) %}
spanning-tree edge-port bpduguard default
{%     elif spanning_tree.edge_port.bpduguard_default is arista.avd.defined(false) %}
no spanning-tree edge-port bpduguard default
{%     endif %}
{%     if spanning_tree.edge_port.bpdufilter_default is arista.avd.defined(true) %}
spanning-tree edge-port bpdufilter default
{%     elif spanning_tree.edge_port.bpdufilter_default is arista.avd.defined(false) %}
no spanning-tree edge-port bpdufilter default
{%     endif %}
{%     if spanning_tree.mode is arista.avd.defined('mstp') %}
{%         for mst_instance in spanning_tree.mst_instances | arista.avd.natural_sort %}
{%             if spanning_tree.mst_instances[mst_instance].priority is arista.avd.defined %}
spanning-tree mst {{ mst_instance }} priority {{ spanning_tree.mst_instances[mst_instance].priority }}
{%             endif %}
{%         endfor %}
{%     elif spanning_tree.mode is arista.avd.defined('rapid-pvst') %}
{%         for vlan_id in spanning_tree.rapid_pvst_instances | arista.avd.natural_sort %}
{%             if spanning_tree.rapid_pvst_instances[vlan_id].priority is arista.avd.defined %}
spanning-tree vlan-id {{ vlan_id }} priority {{ spanning_tree.rapid_pvst_instances[vlan_id].priority }}
{%             endif %}
{%         endfor %}
{%     else %}
{%         if spanning_tree.rstp_priority is arista.avd.defined %}
spanning-tree priority {{ spanning_tree.rstp_priority }}
{%         endif %}
{%     endif %}
{%     if spanning_tree.mst.configuration is arista.avd.defined %}
!
spanning-tree mst configuration
{%         if spanning_tree.mst.configuration.name is arista.avd.defined %}
   name {{ spanning_tree.mst.configuration.name }}
{%         endif %}
{%         if spanning_tree.mst.configuration.revision is arista.avd.defined %}
   revision {{ spanning_tree.mst.configuration.revision }}
{%         endif %}
{%         for instance in spanning_tree.mst.configuration.instances | arista.avd.natural_sort %}
{%             if spanning_tree.mst.configuration.instances[instance].vlans is arista.avd.defined %}
   instance {{ instance }} vlan {{ spanning_tree.mst.configuration.instances[instance].vlans }}
{%             endif %}
{%         endfor %}
{%     endif %}
{% endif %}
