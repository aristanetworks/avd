{% set ip_pool = switch.p2p_network_summary %}
{# max number of hosts in subnet will be divided by max super-spine number to avoid address changes when provisioning new spines #}
{% set ip_pool_max_hosts_in_subnet = ip_pool | ansible.netcommon.ipaddr('size') %}
{% set offset = (switch.id - 1) % switch.max_parallel_uplinks %}
{{ ip_pool | ansible.netcommon.ipaddr('network') | ansible.netcommon.ipmath(
    (ip_pool_max_hosts_in_subnet / switch.max_uplink_switches) | int * (uplink_switch_index) + ((switch.id - 1) * switch.max_parallel_uplinks + offset) * 2 + 1) }}
