{% if underlay_routing_protocol == "OSPF" %}
  process_ids:
    {{ underlay_ospf_process_id }}:
      passive_interface_default: true
{%     if type == "spine" %}
      router_id: {{ overlay_loopback_network_summary | ipaddr('network') | ipmath(spine.nodes[inventory_hostname].id) }}
      no_passive_interfaces:
{# Point-to-Point Interfaces to Leaf Switches #}
{%         for l3leaf_node_group in l3leafs.node_groups | natural_sort %}
{%             if l3leafs.node_groups[l3leaf_node_group].spines is defined %}
{%                 set leaf_spines = l3leafs.node_groups[l3leaf_node_group].spines %}
{%             else %}
{%                 set leaf_spines = l3leafs.defaults.spines %}
{%             endif %}
{%             for node in l3leafs.node_groups[l3leaf_node_group].nodes | natural_sort %}
{%                 set spine_interfaces = l3leafs.node_groups[l3leaf_node_group].nodes[node].spine_interfaces %}
{%                 if l3leafs.node_groups[l3leaf_node_group].uplink_to_spine_interfaces is defined %}
{%                     set uplink_to_spine_interfaces = l3leafs.node_groups[l3leaf_node_group].uplink_to_spine_interfaces %}
{%                 else %}
{%                     set uplink_to_spine_interfaces = l3leafs.defaults.uplink_to_spine_interfaces %}
{%                 endif %}
{%                 for leaf_spine in leaf_spines %}
{%                     if leaf_spine == inventory_hostname %}
        - {{ spine_interfaces[loop.index0] }}
{%                     endif %}
{%                 endfor %}
{%             endfor %}
{%         endfor %}
{%     endif %}
{%     if type == "l3leaf" %}
      router_id: {{ overlay_loopback_network_summary | ipaddr('network') | ipmath(leaf.id + spine.nodes | length) }}
      no_passive_interfaces:
{%         for uplink_to_spine_interface in leaf.uplink_to_spine_interfaces %}
        - {{ uplink_to_spine_interface }}
{%         endfor %}
{%     endif %}
      network_prefixes:
        {{ underlay_p2p_network_summary }}:
          area: {{ underlay_ospf_area }}
        {{ overlay_loopback_network_summary }}:
          area: {{ underlay_ospf_area }}
        {{ vtep_loopback_network_summary }}:
          area: {{ underlay_ospf_area }}
      max_lsa: {{ underlay_ospf_max_lsa }}
{% endif %}